<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Macros for blueprint authoring — blueprint_macros • blueprintr</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Macros for blueprint authoring — blueprint_macros"><meta property="og:description" content="blueprintr uses code inspection to identify and trace dataset dependencies.
These macro functions signal a dependency to blueprintr and evaluate to
symbols to be analyzed in the drake plan."><meta property="og:image" content="/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">blueprintr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.2.7</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/blueprintr.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/nyuglobalties/blueprintr/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Macros for blueprint authoring</h1>
    <small class="dont-index">Source: <a href="https://github.com/nyuglobalties/blueprintr/blob/v0.2.7/R/macros.R" class="external-link"><code>R/macros.R</code></a></small>
    <div class="hidden name"><code>blueprint_macros.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><code>blueprintr</code> uses code inspection to identify and trace dataset dependencies.
These macro functions signal a dependency to <code>blueprintr</code> and evaluate to
symbols to be analyzed in the <code>drake</code> plan.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">.TARGET</span><span class="op">(</span><span class="va">bp_name</span>, .env <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sys.parent.html" class="external-link">parent.frame</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">.BLUEPRINT</span><span class="op">(</span><span class="va">bp_name</span>, .env <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sys.parent.html" class="external-link">parent.frame</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">.META</span><span class="op">(</span><span class="va">bp_name</span>, .env <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sys.parent.html" class="external-link">parent.frame</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">.SOURCE</span><span class="op">(</span><span class="va">dat_name</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">mark_source</span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>


<dl><dt id="arg-bp-name">bp_name<a class="anchor" aria-label="anchor" href="#arg-bp-name"></a></dt>
<dd><p>Character string of blueprint's name</p></dd>


<dt id="arg--env">.env<a class="anchor" aria-label="anchor" href="#arg--env"></a></dt>
<dd><p>The environment in which to evaluate the macro. For internal
use only!</p></dd>


<dt id="arg-dat-name">dat_name<a class="anchor" aria-label="anchor" href="#arg-dat-name"></a></dt>
<dd><p>Character string of an object's name, used exclusively
for marking "sources"</p></dd>


<dt id="arg-dat">dat<a class="anchor" aria-label="anchor" href="#arg-dat"></a></dt>
<dd><p>A data.frame-like object</p></dd>

</dl></div>
    <div id="functions">
    <h2>Functions</h2>

<ul><li><p><code>.TARGET()</code>: Gets symbol of built and checked data</p></li>
<li><p><code>.BLUEPRINT()</code>: Gets symbol of blueprint reference in plan</p></li>
<li><p><code>.META()</code>: Gets symbol of metadata reference in plan</p></li>
<li><p><code>.SOURCE()</code>: Gets a symbol for an object intended to be a
"data source"</p></li>
<li><p><code>mark_source()</code>: Mark an data.frame-like object as a source table</p></li>
</ul></div>
    <div id="when-to-use">
    <h2>When to use</h2>
    <p>Generally speaking, the <code>.BLUEPRINT</code> and <code>.META</code> macros should be used for
check functions, which frequently require context, e.g. in the form of
configuration from the blueprint or coding expectations from the metadata.
<code>.TARGET</code> is primarily used in blueprint commands, but there could be
situations where a check depends on the content of another dataset.</p>
<p>It is important to note that the symbols generated by these macros are only
understood in the context of a <code>drake</code> plan. The targets associated with the
symbols are generated when blueprints are attached to a plan.</p>
    </div>
    <div id="sources">
    <h2>Sources</h2>
    <p>Sources are an ability to add variable UUIDs to objects that are not constructed
using blueprints. This is often the case if the sourced table derives from some
intermittent HTTP query or a file from disk. Blueprints have limited capability
of configuring the underlying target behavior during the <code>_initial</code> phase, so often
it is easier to do that sort of fetching and pre-processing before using blueprints.
However, you lose the benefit of variable lineage when you don't use blueprints.
"Sources" are simply data.frame-like objects that have the ".uuid" attribute for each
variable so that variable lineage can cover the full data lifetime. Use <code>blueprintr::mark_source()</code>
to add the UUID attributes, and then use <code>.SOURCE()</code> in the blueprints so lineage
can be captured</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu">.TARGET</span><span class="op">(</span><span class="st">"example_dataset"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> example_dataset</span>
<span class="r-in"><span><span class="fu">.BLUEPRINT</span><span class="op">(</span><span class="st">"example_dataset"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> example_dataset_blueprint</span>
<span class="r-in"><span><span class="fu">.META</span><span class="op">(</span><span class="st">"example_dataset"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> example_dataset_meta</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="blueprint.html">blueprint</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="st">"test_bp"</span>,</span></span>
<span class="r-in"><span>  description <span class="op">=</span> <span class="st">"Blueprint with dependencies"</span>,</span></span>
<span class="r-in"><span>  command <span class="op">=</span></span></span>
<span class="r-in"><span>    <span class="fu">.TARGET</span><span class="op">(</span><span class="st">"parent1"</span><span class="op">)</span> <span class="op">%&gt;%</span></span></span>
<span class="r-in"><span>      <span class="fu">left_join</span><span class="op">(</span><span class="fu">.TARGET</span><span class="op">(</span><span class="st">"parent2"</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span> <span class="op">%&gt;%</span></span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;blueprint: 'test_bp'&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Description: Blueprint with dependencies</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Annotations: DISABLED</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Metadata location: '/home/runner/work/blueprintr/blueprintr/blueprints/test_bp.csv'</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -- Command --</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Workflow command:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> parent1 %&gt;% left_join(parent2, by = "id") %&gt;% filter(!is.na(id))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Raw command:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> .TARGET("parent1") %&gt;% left_join(.TARGET("parent2"), by = "id") %&gt;% </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     filter(!is.na(id))</span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Patrick Anker.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

      </footer></div>






  </body></html>

